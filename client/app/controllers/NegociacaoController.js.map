{"version":3,"sources":["../../app-src/controllers/NegociacaoController.js"],"names":["Negociacoes","NegociacaoService","Negociacao","NegociacoesView","MensagemView","Mensagem","DataInvalidaException","DateConverter","getNegociacaoDao","Bind","NegociacaoController","constructor","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_negociacoes","_mensagem","_service","_init","adiciona","event","preventDefault","negociacao","_criaNegociacao","then","dao","texto","_limpaFormulario","catch","err","console","log","stack","message","apaga","apagaTodos","esvazia","importaNegociacoes","obtemNegociacoesDoPeriodo","novasNegociacoes","filter","novaNegociacao","paraArray","some","negociacaoExistente","equals","negociacoes","forEach","value","focus","paraData","parseInt","parseFloat","listaTodos"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import { Negociacoes, NegociacaoService, Negociacao } from '../domain/index.js'\nimport {\n  NegociacoesView,\n  MensagemView,\n  Mensagem,\n  DataInvalidaException,\n  DateConverter,\n} from '../ui/index.js'\nimport { getNegociacaoDao, Bind } from '../util/index.js'\n\nexport class NegociacaoController {\n  constructor() {\n    const $ = document.querySelector.bind(document)\n\n    this._inputData = $('#data')\n    this._inputQuantidade = $('#quantidade')\n    this._inputValor = $('#valor')\n\n    this._negociacoes = new Bind(\n      new Negociacoes(),\n      new NegociacoesView('#negociacoes'),\n      'adiciona',\n      'esvazia',\n    )\n\n    this._mensagem = new Bind(\n      new Mensagem(),\n      new MensagemView('#mensagemView'),\n      'texto',\n    )\n\n    this._service = new NegociacaoService()\n\n    this._init()\n  }\n\n  adiciona(event) {\n    try {\n      event.preventDefault()\n\n      const negociacao = this._criaNegociacao()\n\n      getNegociacaoDao()\n        .then((dao) => dao.adiciona(negociacao))\n        .then(() => {\n          this._negociacoes.adiciona(negociacao)\n          this._mensagem.texto = 'Negociação adicionada com sucesso'\n          this._limpaFormulario()\n        })\n        .catch((err) => (this._mensagem.texto = err))\n    } catch (err) {\n      console.log(err)\n      console.log(err.stack)\n      if (err instanceof DataInvalidaException) {\n        this._mensagem.texto = err.message\n      } else {\n        this._mensagem.texto =\n          'Um erro não esperado aconteceu. Entre em contato com o suporte'\n      }\n    }\n  }\n\n  apaga() {\n    try {\n      getNegociacaoDao()\n        .then((dao) => dao.apagaTodos())\n        .then(() => {\n          this._negociacoes.esvazia()\n          this._mensagem.texto = 'Negociações apagadas com sucesso'\n        })\n    } catch (err) {\n      this._mensagem.texto = err\n    }\n  }\n\n  importaNegociacoes() {\n    this._service\n      .obtemNegociacoesDoPeriodo()\n      .then((novasNegociacoes) =>\n        novasNegociacoes.filter(\n          (novaNegociacao) =>\n            !this._negociacoes\n              .paraArray()\n              .some((negociacaoExistente) =>\n                negociacaoExistente.equals(novaNegociacao),\n              ),\n        ),\n      )\n      .then((negociacoes) =>\n        negociacoes.forEach((negociacao) =>\n          this._negociacoes.adiciona(negociacao),\n        ),\n      )\n      .then(() => (this._mensagem.texto = 'Negociações importadas com sucesso'))\n      .catch(\n        () =>\n          (this._mensagem.texto = 'Não foi possível importar as negociações'),\n      )\n  }\n\n  _limpaFormulario() {\n    this._inputData.value = ''\n    this._inputQuantidade.value = 1\n    this._inputValor.value = 0.0\n    this._inputData.focus()\n  }\n\n  _criaNegociacao() {\n    return new Negociacao(\n      DateConverter.paraData(this._inputData.value),\n      parseInt(this._inputQuantidade.value),\n      parseFloat(this._inputValor.value),\n    )\n  }\n\n  _init() {\n    getNegociacaoDao()\n      .then((dao) => dao.listaTodos())\n      .then((negociacoes) =>\n        negociacoes.forEach((negociacao) =>\n          this._negociacoes.adiciona(negociacao),\n        ),\n      )\n      .catch((err) => (this._mensagem.texto = err))\n  }\n}\n"]}