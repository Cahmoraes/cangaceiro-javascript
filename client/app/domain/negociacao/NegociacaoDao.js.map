{"version":3,"sources":["../../../app-src/domain/negociacao/NegociacaoDao.js"],"names":["Negociacao","NegociacaoDao","constructor","connection","_connection","_store","adiciona","negociacao","Promise","resolve","reject","request","transaction","objectStore","add","onsuccess","onerror","event","console","log","target","error","listaTodos","negociacoes","cursor","openCursor","atual","result","Date","value","_data","_quantidade","_valor","push","continue","apagaTodos","clear"],"mappings":";;;;;;AAASA,gB,iBAAAA,U;;;UACIC,a,GAAN,MAAMA,aAAN,CAAoB;AACzBC,oBAAYC,UAAZ,EAAwB;AACtB,eAAKC,WAAL,GAAmBD,UAAnB;AACA,eAAKE,MAAL,GAAc,aAAd;AACD;;AAEDC,iBAASC,UAAT,EAAqB;AACnB,iBAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,kBAAMC,UAAU,KAAKP,WAAL,CACbQ,WADa,CACD,CAAC,KAAKP,MAAN,CADC,EACc,WADd,EAEbQ,WAFa,CAED,KAAKR,MAFJ,EAGbS,GAHa,CAGTP,UAHS,CAAhB;;AAKAI,oBAAQI,SAAR,GAAoB,MAAMN,SAA1B;;AAEAE,oBAAQK,OAAR,GAAmBC,KAAD,IAAW;AAC3BC,sBAAQC,GAAR,CAAYF,MAAMG,MAAN,CAAaC,KAAzB;AACAX,qBAAO,sCAAP;AACD,aAHD;AAID,WAZM,CAAP;AAaD;;AAEDY,qBAAa;AACX,iBAAO,IAAId,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,kBAAMa,cAAc,EAApB;;AAEA,kBAAMC,SAAS,KAAKpB,WAAL,CACZQ,WADY,CACA,CAAC,KAAKP,MAAN,CADA,EACe,WADf,EAEZQ,WAFY,CAEA,KAAKR,MAFL,EAGZoB,UAHY,EAAf;;AAKAD,mBAAOT,SAAP,GAAoBE,KAAD,IAAW;AAC5B,oBAAMS,QAAQT,MAAMG,MAAN,CAAaO,MAA3B;AACA,kBAAID,KAAJ,EAAW;AACT,sBAAMnB,aAAa,IAAIP,UAAJ,CACjB,IAAI4B,IAAJ,CAASF,MAAMG,KAAN,CAAYC,KAArB,CADiB,EAEjBJ,MAAMG,KAAN,CAAYE,WAFK,EAGjBL,MAAMG,KAAN,CAAYG,MAHK,CAAnB;AAKAT,4BAAYU,IAAZ,CAAiB1B,UAAjB;AACAmB,sBAAMQ,QAAN;AACD,eARD,MAQO;AACLzB,wBAAQc,WAAR;AACD;AACF,aAbD;;AAeAC,mBAAOR,OAAP,GAAkBC,KAAD,IAAW;AAC1BC,sBAAQC,GAAR,CAAYF,MAAMG,MAAN,CAAaC,KAAzB;AACAX,qBAAO,wCAAP;AACD,aAHD;AAID,WA3BM,CAAP;AA4BD;;AAEDyB,qBAAa;AACX,iBAAO,IAAI3B,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,kBAAMC,UAAU,KAAKP,WAAL,CACbQ,WADa,CACD,CAAC,KAAKP,MAAN,CADC,EACc,WADd,EAEbQ,WAFa,CAED,KAAKR,MAFJ,EAGb+B,KAHa,EAAhB;;AAKAzB,oBAAQI,SAAR,GAAoB,MAAMN,SAA1B;;AAEAE,oBAAQK,OAAR,GAAmBC,KAAD,IAAW;AAC3BC,sBAAQC,GAAR,CAAYF,MAAMG,MAAN,CAAaC,KAAzB;AACAX,qBAAO,wCAAP;AACD,aAHD;AAID,WAZM,CAAP;AAaD;AAnEwB,O","file":"NegociacaoDao.js","sourcesContent":["import { Negociacao } from './Negociacao.js'\nexport class NegociacaoDao {\n  constructor(connection) {\n    this._connection = connection\n    this._store = 'negociacoes'\n  }\n\n  adiciona(negociacao) {\n    return new Promise((resolve, reject) => {\n      const request = this._connection\n        .transaction([this._store], 'readwrite')\n        .objectStore(this._store)\n        .add(negociacao)\n\n      request.onsuccess = () => resolve()\n\n      request.onerror = (event) => {\n        console.log(event.target.error)\n        reject('Não foi possível salvar a negociação')\n      }\n    })\n  }\n\n  listaTodos() {\n    return new Promise((resolve, reject) => {\n      const negociacoes = []\n\n      const cursor = this._connection\n        .transaction([this._store], 'readwrite')\n        .objectStore(this._store)\n        .openCursor()\n\n      cursor.onsuccess = (event) => {\n        const atual = event.target.result\n        if (atual) {\n          const negociacao = new Negociacao(\n            new Date(atual.value._data),\n            atual.value._quantidade,\n            atual.value._valor,\n          )\n          negociacoes.push(negociacao)\n          atual.continue()\n        } else {\n          resolve(negociacoes)\n        }\n      }\n\n      cursor.onerror = (event) => {\n        console.log(event.target.error)\n        reject('Não foi possível listar as negociações')\n      }\n    })\n  }\n\n  apagaTodos() {\n    return new Promise((resolve, reject) => {\n      const request = this._connection\n        .transaction([this._store], 'readwrite')\n        .objectStore(this._store)\n        .clear()\n\n      request.onsuccess = () => resolve()\n\n      request.onerror = (event) => {\n        console.log(event.target.error)\n        reject('Não foi possível apagar as negociações')\n      }\n    })\n  }\n}\n"]}