webpackJsonp([1],[,function(a,b,c){"use strict";c.d(b,"a",function(){return d});let d=class{constructor(a,b,c){Object.assign(this,{_quantidade:b,_valor:c,_data:new Date(a.getTime())}),Object.freeze(this)}get volume(){return this._quantidade*this._valor}get data(){return new Date(this._data.getTime())}get quantidade(){return this._quantidade}get valor(){return this._valor}equals(a){return JSON.stringify(this)===JSON.stringify(a)}}},function(a,b,c){"use strict";function d(a){return a instanceof f||Object.getPrototypeOf(a)instanceof f}c.d(b,"a",function(){return e}),b.b=function(a){return d(a)?a.message:(console.log(a),"N\xE3o foi poss\xEDvel realizar a opera\xE7\xE3o")};let e=class extends Error{constructor(a=""){super(a),this.name=this.constructor.name}};const f=e},,function(a,b,c){"use strict";c.d(b,"a",function(){return d});let d=class{get(a){return fetch(a).then(this._handleErrors)}_handleErrors(a){if(!a.ok)throw new Error(a.statusText);return a.json()}}},function(a,b,c){"use strict";function d(a){return function(){var b=a.apply(this,arguments);return new Promise(function(a,c){function d(e,f){try{var g=b[e](f),h=g.value}catch(a){return void c(a)}return g.done?void a(h):Promise.resolve(h).then(function(a){d("next",a)},function(a){d("throw",a)})}return d("next")})}}function e(a=500){return(b,c,d)=>{const e=d.value;let f=0;return d.value=function(...b){const c=b[0];c instanceof SubmitEvent&&c.preventDefault(),f&&clearTimeout(f),f=setTimeout(()=>{Reflect.apply(e,this,b)},a)},d}}function f(a,b){document.querySelector(b.selector).addEventListener(b.event,(c)=>{b.prevent&&c.preventDefault(),a[b.propertyKey](c)})}function g(a){throw new Error(`${a} é um parâmetro obrigatório`)}function h(a=g("event"),b=g("selector"),c=!0){return function(d,e,f){return Reflect.defineMetadata("bindEvent",{event:a,selector:b,prevent:c,propertyKey:e},Object.getPrototypeOf(d),e),f}}function i(a){return function(){var b=a.apply(this,arguments);return new Promise(function(a,c){function d(e,f){try{var g=b[e](f),h=g.value}catch(a){return void c(a)}return g.done?void a(h):Promise.resolve(h).then(function(a){d("next",a)},function(a){d("throw",a)})}return d("next")})}}function j(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}Object.defineProperty(b,"__esModule",{value:!0});var k=c(1);let l=class{constructor(a){this._connection=a,this._store="negociacoes"}adiciona(a){return new Promise((b,c)=>{const d=this._connection.transaction([this._store],"readwrite").objectStore(this._store).add(a);d.onsuccess=()=>b(),d.onerror=(a)=>{console.log(a.target.error),c("N\xE3o foi poss\xEDvel salvar a negocia\xE7\xE3o")}})}listaTodos(){return new Promise((a,b)=>{const c=[],d=this._connection.transaction([this._store],"readwrite").objectStore(this._store).openCursor();d.onsuccess=(b)=>{const d=b.target.result;if(d){const a=new k.a(new Date(d.value._data),d.value._quantidade,d.value._valor);c.push(a),d.continue()}else a(c)},d.onerror=(a)=>{console.log(a.target.error),b("N\xE3o foi poss\xEDvel listar as negocia\xE7\xF5es")}})}apagaTodos(){return new Promise((a,b)=>{const c=this._connection.transaction([this._store],"readwrite").objectStore(this._store).clear();c.onsuccess=()=>a(),c.onerror=(a)=>{console.log(a.target.error),b("N\xE3o foi poss\xEDvel apagar as negocia\xE7\xF5es")}})}},m=class{constructor(){this._negociacoes=[],Object.freeze(this)}get volumeTotal(){return this._negociacoes.reduce((a,b)=>a+b.volume,0)}adiciona(a){this._negociacoes.push(a)}paraArray(){return[].concat(this._negociacoes)}esvazia(){this._negociacoes.length=0}};var n=c(1);let o=class{constructor(a){this._elemento=document.querySelector(a)}template(){throw new Error("Voc\xEA precisa implementar o m\xE9todo template")}update(a){this._elemento.innerHTML=this.template(a)}},p=class extends o{template(a){return a.texto?`
    <p class="alert alert-info">${a.texto}</p>
    `:`
    <p></p>
    `}update(a){this._elemento.innerHTML=this.template(a)}};var q=c(2);let r=class extends q.a{constructor(){super("A data deve estar no formato dd/mm/aaaa")}},s=class{constructor(){throw new Error("Esta classe n\xE3o pode ser instanciada")}static paraTexto(a){return`${a.getDate()}/${a.getMonth()+1}/${a.getFullYear()}`}static paraData(a){if(!/\d{2}\/\d{2}\/\d{4}/.test(a))throw new r;return new Date(...a.split("/").reverse().map((a,b)=>a-b%2))}},t=class extends o{update(a){this._elemento.innerHTML=this.template(a)}template(a){return`
    <table class="table table-hover table-bordered">
    <thead>
      <tr>
        <th>DATA</th>
        <th>QUANTIDADE</th>
        <th>VALOR</th>
        <th>VOLUME</th>
      </tr>
    </thead>
    <tbody>
      ${a.paraArray().map((a)=>`
        <tr>
          <td>${s.paraTexto(a.data)}</td>
          <td>${a.quantidade}</td>
          <td>${a.valor}</td>
          <td>${a.volume}</td>
        </tr>
        `).join("")}
    </tbody>
    <tfoot>
          <tr>
            <td colspan="3"></td>
            <td>${a.volumeTotal}</td>
          </tr>
    </tfoot>
  </table>
  `}},u=class{constructor(a=""){this._texto=a}get texto(){return this._texto}set texto(a){this._texto=a}},v=class a{static create(b,c,d){return new Proxy(b,{get(b,e,f){return a._ehFuncao(b[e])&&c.includes(e)?function(...a){console.log(`${e} disparou a armadilha`);const c=Reflect.apply(b[e],b,a);return d(b),c}:Reflect.get(b,e,f)},set(a,b,e,f){const g=Reflect.set(a,b,e,f);return c.includes(b)&&d(a),g}})}static _ehFuncao(a){return"function"==typeof a}},w=class{constructor(a,b,...c){const d=v.create(a,c,(a)=>{b.update(a)});return b.update(a),d}};const x=(()=>{let a=null;const b=["negociacoes"];let c=null;return class{constructor(){throw new Error("N\xE3o \xE9 poss\xEDvel criar inst\xE2ncias dessa classe")}static getConnection(){return new Promise((b,d)=>{if(a)return console.log("connection cacheada"),b(a);const e=indexedDB.open("jscangaceiro",2);e.onupgradeneeded=(a)=>{this._createStores(a.target.result)},e.onsuccess=(d)=>{a=d.target.result,c=a.close,a.close=()=>{throw new Error("Voc\xEA n\xE3o pode fechar diretamente a conex\xE3o")},b(d.target.result)},e.onerror=(a)=>d(a.target.error.name)})}static _createStores(a){b.forEach((b)=>{a.objectStoreNames.contains(b)&&a.deleteObjectStore(b),a.createObjectStore(b,{autoIncrement:!0})})}static closeConnection(){return!!a&&(console.log("fechando a conex\xE3o"),Reflect.apply(c,a,[]),!0)}}})();let y=(()=>{var a=d(function*(){try{const a=yield x.getConnection();return new l(a)}catch(a){return a}});return function(){return a.apply(this,arguments)}})();var z,A,B,C,D,E,F,G,H=c(2),I=c(4);let J=(z=function(...a){const b=a.map((a)=>document.querySelector(a));return function(a){const c=a,d=function(){const a=new c(...b);Object.getOwnPropertyNames(c.prototype).forEach((b)=>{Reflect.hasMetadata("bindEvent",a,b)&&f(a,Reflect.getMetadata("bindEvent",a,b))})};return d.prototype=c.prototype,d}}("#data","#quantidade","#valor"),A=h("submit",".form"),B=e(),C=h("click","#botao-apaga"),D=h("click","#botao-importa"),E=e(1500),z(F=(G=class{constructor(a=g("data"),b=g("quantidade"),c=g("valor")){Object.assign(this,{_inputData:a,_inputQuantidade:b,_inputValor:c}),this._negociacoes=new w(new m(),new t("#negociacoes"),"adiciona","esvazia"),this._mensagem=new w(new u(),new p("#mensagemView"),"texto"),this._init()}adiciona(a){var b=this;return i(function*(){try{a.preventDefault();const c=b._criaNegociacao(),d=yield y();yield d.adiciona(c),b._negociacoes.adiciona(c),b._mensagem.texto="Negocia\xE7\xE3o adicionada com sucesso",b._limpaFormulario()}catch(a){b._mensagem.texto=H.b(a)}})()}apaga(){var a=this;return i(function*(){try{const b=yield y();yield b.apagaTodos(),a._negociacoes.esvazia(),a._mensagem.texto="Negocia\xE7\xF5es apagadas com sucesso"}catch(b){a._mensagem.texto=H.b(b)}})()}importaNegociacoes(){var a=this;return i(function*(){try{const{NegociacaoService:b}=yield c.e(0).then(c.bind(null,25)),d=new b,e=yield d.obtemNegociacoesDoPeriodo();e.filter(function(b){return!a._negociacoes.paraArray().some(function(a){return a.equals(b)})}).forEach(function(b){return a._negociacoes.adiciona(b)}),a._mensagem.texto="Negocia\xE7\xF5es importadas com sucesso"}catch(b){a._mensagem.texto=H.b(b)}})()}_limpaFormulario(){this._inputData.value="",this._inputQuantidade.value=1,this._inputValor.value=0,this._inputData.focus()}_criaNegociacao(){return new n.a(s.paraData(this._inputData.value),parseInt(this._inputQuantidade.value),parseFloat(this._inputValor.value))}_init(){var a=this;return i(function*(){try{const b=yield y(),c=yield b.listaTodos();c.forEach(function(b){return a._negociacoes.adiciona(b)})}catch(b){a._mensagem.texto=H.b(b)}})()}},j(G.prototype,"adiciona",[A,B],Object.getOwnPropertyDescriptor(G.prototype,"adiciona"),G.prototype),j(G.prototype,"apaga",[C],Object.getOwnPropertyDescriptor(G.prototype,"apaga"),G.prototype),j(G.prototype,"importaNegociacoes",[D,E],Object.getOwnPropertyDescriptor(G.prototype,"importaNegociacoes"),G.prototype),G))||F);(function(a){var b=c(6),d=c.n(b),e=c(7),f=c.n(e),g=c(3),h=c.n(g),i=c(8),j=c.n(i);a("h1").on("click",()=>alert("Foi\xA0clicado!")),new J}).call(b,c(0))},function(){},function(){},function(){}],[5]);